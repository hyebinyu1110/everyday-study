## AJAX

[참조 영상:(애플코딩) Ajax가 무엇인지 설명하는 영상 (+CORS, fetch 어쩌구)](https://www.youtube.com/watch?v=nKD1atl6cAw)

결론: ajax 는 그냥 서버로 몰래 데이터 요청하는 코드일뿐이다.

#### GET하는 방법

1. URL 로 GET 요청
2. 버튼으로 GET 요청 -> 전부 브라우저가 새로고침됨.
3. AJAX로 GET 요청 -> 새로고침없이 GET 요청하는 쪼그만한 JS 코드

-   장점: 새로고침이 없으니까 웹페이지 전환이 부드러워진다.
-   fb, instagram 새로운 데이터를 요구할 때, 새로고침이 절대 되지 않고 부드럽게 데이터를 가져옴 -> 부드러운 웹앱을 만들수 있음

#### html 에서 서버로 ajax 요청하는 3가지 방법

1. 옛날 JS 방식 => 코드 길고 복잡해서 요즘 아무도 안씀

```Java Script
var ajax = new XMLHttpsRequest();
ajax.onreadystatechange = function(){
    if(this.readystate === 4 && this.status === 2000){
        console.log(ajax.responseText);
    }

    ajax.open("GET", "https://codingapple1.github.io/price.json", true);
    ajax.send();
};
```

2. 요즘 JS 방식 => fetch 기본 함수 에 url 적으면 자동으로 get 요청을 해줌

```Java Script
fetch("https://codingapple1.github.io/price.json");
.then((response) =>{
    if(!response.ok){
        throw new Error('400 아니면 500에러남');
    }
    return response.json();
})
.then((결과) =>{
    console.log(결과);
})
.catch((e) =>{ // 모종의 이유로 요청이 실패했을 때 에러를 알려줌
    console.log(e);
});
```

then 함수 붙이는 게 싫으면 아래의 방식 대로 , 코드 양은 비슷한대 마음에 드는거 가져다 쓰면 된다.

```Java Script
async funtion 데이터 가지고오는 함수(){
    var response = await fetch("https://codingapple1.github.io/price.json");
 if(!response.ok){
        throw new Error('400 아니면 500에러남');
    }

    var result = await response.json();
    console.log(result);
}

데이터 가지고오는 함수().catch((e) =>{ // 모종의 이유로 요청이 실패했을 때 에러를 알려줌
    console.log(e);
});
```

이것도 길다. 데이터 가져오는데 몇줄을 써야 하느냐

3.  외부 라이브러리 방식

-   jquery 는 $.ajax()
-   React 나 Vue 환경에서는 axios 라이브러리 설치해서 많이 씀

```Java Script
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.24.0/axios.min.js"></script>

<script>

axios.get('https://codingapple1.github.io/price.json') // data를 get 요청으로 가져옴
.then((result) =>{
    console.log(result.data) // 성공하면 콘솔창에 출력됨 => 서버에서 받아온 데이터
}).catch(()=>{
    console.log('에러남');
})

```

#### ajax 사용시 자주 발생하는 오류 => CORS(Cross-Origin-Resource-Sharing) 관련 에러 메시지

-   이유: 내가 naver.com 에서 개발을 진행하고 있는데, 갑자기 kakao.com으로 내가 ajax 요청을 날릴 수 없음
-   원칙적으로 서버에서 그런 ajax 서버요청을 차단하도록 되어 있음(보안때문에 차단해 놓은 것)
-   내 집구석에서는 개발할 때 그런것 필요없으니 CORS 보안장치 기능을 잠깐 끄고 싶으면 서버에다가 이렇게 아래와 같이 개발해 두면 됨.
    헤더에 Access-Control-Allow-Origin: "\*" 이런걸 추가하거나 CORS 정책 관련 기능을 끄거나
-   node.js 에서는 var cors = require('cors);
-   app.use(cors()); 해놓으면 에러가 뜨지 않을 것!
